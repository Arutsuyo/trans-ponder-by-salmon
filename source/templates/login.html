<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
	<title>User Registration</title>
	<!-- 'viewport' is used by bootstrap to respond to device size -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Javascript:  JQuery from a content distribution network (CDN) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
	</script>
	<!-- Bootstrap includes javascript and css  (must follow jquery) -->
	<link rel="stylesheet"
		  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js">
	</script>
	<!-- Our own style sheet -->
	<!--<link rel="stylesheet" href="/static/css/memos.css" />-->
</head>
<body>
	<div class="container">
		<h1>Enter Information:</h1>
		<ul id="messageul" hidden>
			<li id="message" />
		</ul>
		<br />
		<input type="text" name="username" id="username" placeholder="(Username)" />
		<ul id="goodnameul" hidden>
			<li id="goodname">
		</ul>
		<br id="spacer"/>
		<input type="text" name="password" id="password" placeholder="(Password)" />
		<br />
		<input type="text" name="volunteer_pass" id="volunteer_pass" placeholder="(optional)" />
		<br />
		<button class="submit" id="regButton">Register</button>
		<script type="text/javascript">

var SCRIPT_ROOT = {{ request.script_root| tojson | safe }};
var REGISTER_URL = SCRIPT_ROOT + "/_register";
var CHECK_URL = SCRIPT_ROOT + "/_checkname";
var LOGIN_URL = SCRIPT_ROOT + "/_login";

function add_user() {
	console.log("Adding a User: ");
	var username = $('#username').val();
	var password = $('#password').val();
	var volunteer_pass = $('#volunteer_pass').val();
	console.log("User: ", username, password, volunteer_pass);
	$.getJSON(REGISTER_URL, {
		username: username,
		password: password,
		volunteer_pass: volunteer_pass
		}, function (data) {
			var res = data.result;
			console.log(res);
			if (res.error) {
				console.log(res.error);
				$('#message')[0].innerHTML = res.error;
				$('#messageul').removeAttr("hidden");
			}
			else {
				console.log("User added")
				$('#username').val('');
				$('#password').val('');
				$('#volunteer_pass').val('');
				$('#message')[0].innerHTML = 'User Added successfully!';
				$('#goodname')[0].innerHTML = '';
				$('#goodnameul').hide();
				$('#spacer').removeAttr("hidden");
			}
	});
}

	function check_user() {
		var username = $('#username').val();
		console.log("User: ", username);
		$.getJSON(CHECK_URL, {
			username: username
		}, function (data) {
			var res = data.result;
			console.log(res);
			if (res) {
				console.log("Name Unavailable");
				$('#spacer').hide();
				$('#goodname')[0].innerHTML = 'Unavailable';
				$('#goodnameul').removeAttr("hidden");
			}
			else {
				console.log("Name Available")
				$('#spacer').hide();
				$('#goodname')[0].innerHTML = 'Available';
				$('#goodnameul').removeAttr("hidden");
			}
		});
}



$(document).ready(function () { onPageLoad(); });
function onPageLoad() {
	// Add a listener for the new memo button.
	console.log("Adding Button reg")
	$("#regButton").click(function () {
		console.log("reg clicked")
		add_user()
	});
	console.log("Adding change listener")
	$("#username").change(function () {
		check_user();
	});
}
		</script>
	</div>
</body>
</html>
